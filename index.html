<!DOCTYPE html>
<html>

<head lang="en">
    <title> Harbor 5th Ward </title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="Description" content="Harbor 5th Ward" />
    <meta property="og:title" content="Harbor 5th Ward" />
    <meta property="og:image" content="https://harbor5thward.github.io/img/mount_timpanogos_utah_temple.jpeg" />
    <meta property="og:description" content="Ward website with meeting links"/>
    <link rel="stylesheet" href="./index.css"></link>
    <!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.1/css/all.css"> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js" integrity="sha256-/H4YS+7aYb9kJ5OKhFYPUjSJdrtV6AeyJOtTkw6X72o=" crossorigin="anonymous"></script>
    <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
</head>

<body>
    <header>
        <h1>Harbor 5th Ward</h1>
    </header>
    <section id="buttons">
        <a href="https://directory.churchofjesuschrist.org/"><button>Directory</button></a>
        <a href="https://www.facebook.com/groups/352374239338591"><button>Facebook</button></a>
        <a href="https://goo.gl/maps/G1PoXQ3FHThMsHB77"><button>Map</button></a>
    </section>

    <main class='main'>
        <section id='meetings'>
            <h1>Meetings</h1>

            <button id='sacrament' class='zoom'>
                <h1>Sacrament Meeting</h1>
                <div>Time: 10:30am</div>
                <div>Click to lauch Zoom</div>
            </button>

            <div id="1st3rd" class='text-box'>
                <ul>
                    <h2>1st & 3rd Sundays</h2>
                    <li>Sunday School</li>
                </ul>
            </div>

            <br>

            <div id="2nd4th" class='text-box'>
                <ul>
                    <h2>2nd & 4th Sundays</h2>
                    <li>Relife Society</li>
                    <li>Young Women</li>
                    <li>Elders Quorum</li>
                    <li>Aaronic Priesthood Quorum</li>
                </ul>
            </div>
        </section>

        <section id='updates'>
            <h1>Come Follow Me</h1>
            <div class='text-box'>
                <ul>
                    <li><a id="cfm-if">Individuals and Families</a></li>
                    <li><a id="cfm-ss">Sunday School</a></li>
                    <li><a id="cfm-apqwm">Aaronic Priesthood Quorums and Young Women</a></li>
                    <li><a id="cfm-p">Primary</a></li>
                </ul>
            </div>

            <h1>References</h1>
            <div class='text-box'>
                <ul>
                    <li><a href='https://www.churchofjesuschrist.org/study/manual/general-handbook/21-ministering'>Ministering</a></li>
                    <li>Sacrament Prayers</li>
                    <ul style="list-style-type: circle;">
                        <li><a href='https://www.churchofjesuschrist.org/study/scriptures/sacrament/bread'>Blessing on the Bread</a></li>
                        <li><a href='https://www.churchofjesuschrist.org/study/scriptures/sacrament/water'>Blessing on the Water</a></li>
                    </ul>
                    <li>Priesthood Ordinances and Blessings</li>
                    <ul style="list-style-type: circle;">
                        <li><a href='https://www.churchofjesuschrist.org/study/manual/general-handbook/18-priesthood-ordinances-and-blessings#title_number42'>Administering to the Sick</a></li>
                        <li><a href='https://www.churchofjesuschrist.org/study/manual/general-handbook/18-priesthood-ordinances-and-blessings#title_number39'>Consecrating Oil</a></li>
                    </ul>
                </ul>
            </div>
        </section>
    </main>

    <script>
        const passphrase = 'secret harbor pioneer passphrase';

        window.encrypt = function(text) { return CryptoJS.AES.encrypt(text, passphrase).toString(); }
        decrypt = function(text) { return CryptoJS.AES.decrypt(text, passphrase).toString(CryptoJS.enc.Utf8); }

        let links = [{
            id: 'sacrament',
            url: 'https://zoom.us/j/99707158731',
            // skipio link: 'U2FsdGVkX1+nfc3WeuNd3kv6Fpm7eIi8hBg3Efi9Tv3tsVaAXjd7Ig3M22xzul7yZsMG22PFZPKcftoZO+nmxw==',
            link: 'U2FsdGVkX1+yfgJRDqKTS5ig90moKfgcy0Y7Cdh+yWlvaZ1sG0703pMYxzyKetxt',
        }, {
            id: 'adultSundaySchool',
            link: 'U2FsdGVkX197SBpwd7yOgPicP/3GxmOyHFVqIXK+aWZVqTE9xvTOXebV2r1VhhXTGTuniYZXBOwuokJHPTO9CHuuRINXAv/Oo9VGclZKqjcYOWluMt2wxZERDZ3qo0Ur',
        }, {
            id: 'youthSundaySchool',
            link: 'U2FsdGVkX19IGNSJJ4zKMFwVBz8lICFiwioGTN1zTgfdAYO1OIo7rJWg+0AyCOw2krXPc4AwPNgzwh+UO37M8ItKdSD00z3jAwWz7qRKWUlKN2Zs/yFT7NweIsV1ghDy',
        }, {
            id: 'reliefSociety',
            link: 'U2FsdGVkX19ZqN1F8r9T55SB7VyL5h/wvLv2T8nfMW5uRy/6KiKu1NVGs5aN9oX4XmyqFOX8JH8Q9j2qzy8ZulO041uYeQ+9pjqjIT6r3GWnMqnuCtKo0ftwNy9LGIMo',
        }, {
            id: 'youngWomens',
            link: 'U2FsdGVkX1+GojpbeCEYGNoAyXugFBTfE0LqNL5cNzgVm39RVP7YYCWMn6k93aExGt64l5GwYVW4h9Vs0Flb5XSMguHDC7vTDHmvTV0OF1y6SkkOaPYhb/ELcOHmuL0i',
        }, {
            id: 'eldersQuorum',
            link: 'U2FsdGVkX18FMlP3vAGjgsvT+BisfmGQECQcuUrO63WLc26xkUq424ZFr0OwP/dvGuS9uy+FhyUt47ci8PXtesQjiNst9GfCXcOoyg1La1mUI426iyH/R3ms8Dke/Hz0',
        }, {
            id: 'aaronicPriesthoodQuorum',
            link: 'U2FsdGVkX1+V4XBZR7Ag3PE9kkaTd6u+fBA/Z/QArHgVOSSO65ytra9NuBitGHTq9vE7aerpZwQtTw9H1ktnqpNmObZPhz+wh//6dcWJ388p89QDQccxT72fAbKfMQDQ',
        }].map(v => {
            var el = document.getElementById(v.id);
            if (!!el) {
                el.onclick = function () {
                    let link = window.decrypt(v.link);
                    console.log(v.id, link);
                    window.open(link);
                }
            }
        });

        const now = () => new Date(); // For testing future dates
        // const now = () => new Date('01 Mar 2021 00:00:00 MST');

        Date.prototype.getWeekOfMonth = function(exact) {
            var month = this.getMonth()
                , year = this.getFullYear()
                , firstWeekday = new Date(year, month, 1).getDay()
                , lastDateOfMonth = new Date(year, month + 1, 0).getDate()
                , offsetDate = this.getDate() + firstWeekday - 1
                , index = 1 // start index at 0 or 1, your choice
                , weeksInMonth = index + Math.ceil((lastDateOfMonth + firstWeekday - 7) / 7)
                , week = index + Math.floor(offsetDate / 7)
            ;
            if (exact || week < 2 + index) return week;
            return week === weeksInMonth ? index + 5 : week;
        };

        // Takes day of week, 0 is Sunday
        Date.prototype.nextDay = function (dayOfWeek) {
            this.setDate(this.getDate() + (dayOfWeek+(7-this.getDay())) % 7);
            return this
        }

        Date.prototype.getWeekNumber = function(){
            var d = new Date(Date.UTC(this.getFullYear(), this.getMonth(), this.getDate()));
            var dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
            return Math.ceil((((d - yearStart) / 86400000) + 1)/7)
        };

        function firstSunday(date) {
            const d = new Date(date.getTime());
            d.setDate(1);
            let day = d.getDay();
            let toNextSun = day !== 0 ? 7 - day : 0;
            d.setDate(d.getDate() + toNextSun);
            return d
        }

        (function () { // Move down 1st and 3rd if next Sunday is the 2nd or 4th
            const nextSunday = now().nextDay(0);
            let weekOfMonth = nextSunday.getWeekOfMonth(true);
            if (firstSunday(nextSunday).getWeekOfMonth(true) === 2) {
                weekOfMonth--;
            }
            if (weekOfMonth === 2 || weekOfMonth == 4) {
                document.getElementById('1st3rd').style.order = '20';
                return;
            }
        }());

        (function () { // populate come follow me links
            const nextSunday = now().nextDay(0);
            let weekOfYear = (nextSunday.getWeekNumber() + 1)
            if (weekOfYear > 52) weekOfYear = 1;

            const year = now().getFullYear()
            const urlPrefix = 'https://www.churchofjesuschrist.org/study/manual/come-follow-me-for-';
            const urlSuffix = `-old-testament-${year}`;
            const weekWithTwoDigits = weekOfYear.toLocaleString('en-US', {minimumIntegerDigits: 2, useGrouping:false});
            document.getElementById('cfm-if').href = `${urlPrefix}individuals-and-families${urlSuffix}/${weekWithTwoDigits}`;
            document.getElementById('cfm-ss').href = `${urlPrefix}sunday-school${urlSuffix}/${weekWithTwoDigits}`;
            document.getElementById('cfm-p').href = `${urlPrefix}primary${urlSuffix}/${weekWithTwoDigits}`;

            const halfWeekWithDigits = Math.max(1, Math.floor(weekOfYear/2)).toLocaleString('en-US', {minimumIntegerDigits: 2, useGrouping:false});
            document.getElementById('cfm-apqwm').href = `${urlPrefix}aaronic-priesthood-quorums-and-young-women-classes-doctrinal-topics-${year}/${halfWeekWithDigits}`;
        }());


    </script>
</body>


</html>
